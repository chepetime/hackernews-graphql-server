# Migration `20200824211221`

This migration has been generated by Jos√© Lugo at 8/24/2020, 4:12:21 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Link" (
"id" SERIAL,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"description" text   NOT NULL ,
"url" text   NOT NULL ,
"postedById" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."User" (
"id" SERIAL,
"name" text   NOT NULL ,
"email" text   NOT NULL ,
"password" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Vote" (
"id" SERIAL,
"linkId" integer   NOT NULL ,
"userId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "Vote.linkId_userId_unique" ON "public"."Vote"("linkId", "userId")

ALTER TABLE "public"."Link" ADD FOREIGN KEY ("postedById")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Vote" ADD FOREIGN KEY ("linkId")REFERENCES "public"."Link"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Vote" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200824205404..20200824211221
--- datamodel.dml
+++ datamodel.dml
@@ -1,38 +1,37 @@
 generator client {
-  provider        = "prisma-client-js"
-  previewFeatures = ["aggregateApi"]
+  provider = "prisma-client-js"
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Link {
-  id          Int      @default(autoincrement()) @id
+  id          Int      @id @default(autoincrement())
   createdAt   DateTime @default(now())
   description String
   url         String
+  postedBy    User?    @relation(fields: [postedById], references: [id])
   postedById  Int?
-  user        User?    @relation(fields: [postedById], references: [id])
-  vote        Vote[]
+  votes       Vote[]
 }
 model User {
-  id       Int    @default(autoincrement()) @id
+  id       Int    @id @default(autoincrement())
   name     String
   email    String @unique
   password String
-  link     Link[]
-  vote     Vote[]
+  links    Link[]
+  Vote     Vote[]
 }
 model Vote {
-  id     Int  @default(autoincrement()) @id
+  id     Int  @id @default(autoincrement())
+  link   Link @relation(fields: [linkId], references: [id])
   linkId Int
+  user   User @relation(fields: [userId], references: [id])
   userId Int
-  link   Link @relation(fields: [linkId], references: [id])
-  user   User @relation(fields: [userId], references: [id])
-  @@unique([linkId, userId], name: "Vote.linkId_userId_unique")
+  @@unique([linkId, userId])
 }
```


